<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙƒØªØ¨ØªÙŠ Ø§Ù„Ø´Ø®ØµÙŠØ© - Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„ÙÙƒØ±ÙŠ</title>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, getDoc, query, where, orderBy, limit, addDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Ø¬Ø¹Ù„ Ù…ØªØºÙŠØ±Ø§Øª Firebase Ù…ØªØ§Ø­Ø© Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù…
        window.db = db;
        window.firestore = { collection, getDocs, doc, getDoc, query, where, orderBy, limit, addDoc, updateDoc, deleteDoc };
    </script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                        },
                        secondary: {
                            500: '#8b5cf6',
                            600: '#7c3aed',
                        }
                    },
                    fontFamily: {
                        'tajawal': ['Tajawal', 'sans-serif'],
                    },
                    animation: {
                        'slide-up': 'slideUp 0.3s ease-out',
                        'slide-down': 'slideDown 0.3s ease-out',
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'fade-out': 'fadeOut 0.3s ease-out',
                    }
                }
            }
        }
    </script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Fuse.js for fuzzy search -->
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>

    <!-- Custom Styles -->
    <style>
        * {
            font-family: 'Tajawal', sans-serif;
        }
        
        body {
            background-color: #f9fafb;
            padding-bottom: 80px;
            min-height: 100vh;
        }
        
        .dark body {
            background-color: #111827;
        }
        
        /* Hide scrollbar */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { 
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* Animations */
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        /* View transitions */
        .view-section {
            animation: fadeIn 0.3s ease;
        }
        
        /* Bottom nav safe area */
        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        /* Status colors */
        .status-reading { background-color: #fef3c7; color: #92400e; }
        .dark .status-reading { background-color: #78350f; color: #fef3c7; }
        .status-want_to_read { background-color: #dbeafe; color: #1e40af; }
        .dark .status-want_to_read { background-color: #1e3a8a; color: #dbeafe; }
        .status-liked { background-color: #dcfce7; color: #166534; }
        .dark .status-liked { background-color: #14532d; color: #dcfce7; }
        .status-recommended { background-color: #f0f9ff; color: #075985; }
        .dark .status-recommended { background-color: #0c4a6e; color: #f0f9ff; }
        .status-changed_me { background-color: #fce7f3; color: #9d174d; }
        .dark .status-changed_me { background-color: #831843; color: #fce7f3; }
        .status-confused { background-color: #f3e8ff; color: #6b21a8; }
        .dark .status-confused { background-color: #581c87; color: #f3e8ff; }
        .status-heavy { background-color: #fee2e2; color: #991b1b; }
        .dark .status-heavy { background-color: #7f1d1d; color: #fee2e2; }
        .status-emotional { background-color: #fef3c7; color: #92400e; }
        .dark .status-emotional { background-color: #78350f; color: #fef3c7; }
        .status-strong_start { background-color: #d1fae5; color: #065f46; }
        .dark .status-strong_start { background-color: #064e3b; color: #d1fae5; }
        .status-experiment { background-color: #e0e7ff; color: #3730a3; }
        .dark .status-experiment { background-color: #312e81; color: #e0e7ff; }
        .status-reread { background-color: #fdf4ff; color: #86198f; }
        .dark .status-reread { background-color: #701a75; color: #fdf4ff; }
        .status-later { background-color: #f1f5f9; color: #475569; }
        .dark .status-later { background-color: #334155; color: #f1f5f9; }
        
        /* Post type colors */
        .post-note { background-color: #dbeafe; color: #1e40af; }
        .dark .post-note { background-color: #1e3a8a; color: #dbeafe; }
        .post-quote { background-color: #f3e8ff; color: #6b21a8; }
        .dark .post-quote { background-color: #581c87; color: #f3e8ff; }
        .post-review { background-color: #dcfce7; color: #166534; }
        .dark .post-review { background-color: #14532d; color: #dcfce7; }
        .post-thought { background-color: #fef3c7; color: #92400e; }
        .dark .post-thought { background-color: #78350f; color: #fef3c7; }
        
        /* Loading skeleton */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        .dark .skeleton {
            background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Book cover placeholder */
        .book-cover {
            background: linear-gradient(45deg, #6b7280, #9ca3af);
            position: relative;
            overflow: hidden;
        }
        
        .dark .book-cover {
            background: linear-gradient(45deg, #4b5563, #6b7280);
        }
        
        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border-radius: 1rem;
            z-index: 1001;
            max-width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideDown 0.3s ease;
        }
        
        .dark .modal-container {
            background-color: #1f2937;
        }
        
        /* Rating stars */
        .rating-star {
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .rating-star:hover {
            transform: scale(1.2);
        }
        
        /* Theme colors */
        .theme-classic { --primary: #0ea5e9; --secondary: #8b5cf6; }
        .theme-light { --primary: #3b82f6; --secondary: #10b981; }
        .theme-dark { --primary: #1f2937; --secondary: #374151; }
        .theme-ocean { --primary: #06b6d4; --secondary: #3b82f6; }
        .theme-neon { --primary: #22d3ee; --secondary: #a855f7; }
        .theme-earth { --primary: #d97706; --secondary: #059669; }
    </style>
</head>
<body class="text-gray-800 font-tajawal dark:bg-gray-900 dark:text-gray-200 theme-classic">
    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-xl font-bold text-gray-900 dark:text-white" id="header-title">ğŸ“š Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„ÙÙƒØ±ÙŠ</h1>
            <div class="flex items-center gap-2">
                <button id="search-btn" class="text-gray-500 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition p-2">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </button>
                <button id="theme-toggle" class="text-gray-500 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition p-2">
                    <i class="fa-solid fa-moon" id="theme-icon"></i>
                </button>
            </div>
        </div>
        
        <!-- Search Bar -->
        <div id="search-bar" class="hidden container mx-auto px-4 pb-3">
            <div class="relative">
                <input type="text" id="search-input" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ÙƒØªØ¨Ø©ØŒ Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§ØªØŒ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª..." 
                       class="w-full px-4 py-3 pr-12 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm dark:text-white">
                <button class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </button>
            </div>
            <!-- Advanced Filters -->
            <div id="advanced-filters" class="hidden mt-3 space-y-3">
                <div class="grid grid-cols-2 gap-2">
                    <select id="filter-type" class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg px-3 py-2 text-sm">
                        <option value="all">ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                        <option value="book">ÙƒØªØ¨</option>
                        <option value="quote">Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª</option>
                        <option value="review">Ù…Ø±Ø§Ø¬Ø¹Ø§Øª</option>
                        <option value="note">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</option>
                        <option value="thought">Ø£ÙÙƒØ§Ø±</option>
                    </select>
                    <select id="filter-rating" class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg px-3 py-2 text-sm">
                        <option value="all">ÙƒÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</option>
                        <option value="5">â­â­â­â­â­</option>
                        <option value="4">â­â­â­â­</option>
                        <option value="3">â­â­â­</option>
                        <option value="2">â­â­</option>
                        <option value="1">â­</option>
                    </select>
                </div>
                <div class="flex items-center justify-between">
                    <button id="apply-filters" class="bg-primary-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-primary-600 transition">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±</button>
                    <button id="reset-filters" class="text-gray-500 dark:text-gray-300 text-sm hover:text-gray-700 dark:hover:text-white transition">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
                </div>
            </div>
            <button id="toggle-filters" class="text-sm text-primary-500 dark:text-primary-400 mt-2">+ ÙÙ„Ø§ØªØ± Ù…ØªÙ‚Ø¯Ù…Ø©</button>
        </div>
    </header>

    <!-- Main Content -->
    <main id="app-container" class="container mx-auto px-4 py-4 min-h-screen">
        
        <!-- Home View -->
        <section id="view-home" class="view-section">
            <div class="mb-6">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</h2>
                <p class="text-sm text-gray-500 dark:text-gray-400">Ø®Ù„Ø§ØµØ© Ù…Ù† Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙŠ ÙˆØ§Ù‚ØªØ¨Ø§Ø³Ø§ØªÙŠ ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø§ØªÙŠ</p>
            </div>
            
            <!-- Posts Container -->
            <div id="posts-container" class="space-y-4">
                <!-- Posts will be loaded here dynamically -->
                <div class="space-y-4" id="posts-skeleton">
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-5 skeleton" style="height: 200px;"></div>
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-5 skeleton" style="height: 150px;"></div>
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-5 skeleton" style="height: 180px;"></div>
                </div>
            </div>
        </section>

        <!-- Library Main View -->
        <section id="view-library" class="view-section hidden">
            <div class="mb-6">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Ø§Ù„Ù…ÙƒØªØ¨Ø©</h2>
                <p class="text-sm text-gray-500 dark:text-gray-400">ØªØµÙØ­ Ù…ÙƒØªØ¨ØªÙŠ ÙˆØ±ÙÙˆÙÙŠ ÙˆØ§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª</p>
            </div>
            
            <!-- Library Menu -->
            <div class="space-y-4">
                <!-- Ø§Ù„Ù…ÙƒØªØ¨Ø© -->
                <div onclick="loadAllBooks()" class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-5 cursor-pointer hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-indigo-100 to-indigo-200 dark:from-indigo-900 dark:to-indigo-800 rounded-xl flex items-center justify-center">
                                <i class="fa-solid fa-book text-indigo-600 dark:text-indigo-300 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-gray-900 dark:text-white">ğŸ“š Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400">ÙƒÙ„ Ø§Ù„ÙƒØªØ¨ ÙÙŠ Ù…ÙƒØªØ¨ØªÙŠ Ø§Ù„Ø´Ø®ØµÙŠØ©</p>
                            </div>
                        </div>
                        <i class="fa-solid fa-arrow-left text-gray-300 dark:text-gray-600"></i>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ø±ÙÙˆÙ -->
                <div onclick="loadStatusesMenu()" class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-5 cursor-pointer hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-orange-100 to-amber-100 dark:from-orange-900 dark:to-amber-800 rounded-xl flex items-center justify-center">
                                <i class="fa-solid fa-layer-group text-orange-600 dark:text-orange-300 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-gray-900 dark:text-white">ğŸ§  Ø§Ù„Ø±ÙÙˆÙ Ø§Ù„Ø°ÙƒÙŠØ©</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400">12 Ø±ÙØ§Ù‹ Ø­Ø³Ø¨ Ø¹Ù„Ø§Ù‚ØªÙƒ Ø¨Ø§Ù„ÙƒØªØ§Ø¨</p>
                            </div>
                        </div>
                        <i class="fa-solid fa-arrow-left text-gray-300 dark:text-gray-600"></i>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª -->
                <div onclick="loadPostsByType('quote')" class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-5 cursor-pointer hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-purple-100 to-pink-100 dark:from-purple-900 dark:to-pink-800 rounded-xl flex items-center justify-center">
                                <i class="fa-solid fa-quote-right text-purple-600 dark:text-purple-300 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-gray-900 dark:text-white">âœï¸ Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400">ÙƒÙ„ Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</p>
                            </div>
                        </div>
                        <i class="fa-solid fa-arrow-left text-gray-300 dark:text-gray-600"></i>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª -->
                <div onclick="loadPostsByType('review')" class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-5 cursor-pointer hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-green-100 to-emerald-100 dark:from-green-900 dark:to-emerald-800 rounded-xl flex items-center justify-center">
                                <i class="fa-solid fa-star text-green-600 dark:text-green-300 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-gray-900 dark:text-white">â­ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400">ØªÙ‚ÙŠÙ…ÙŠØ§ØªÙŠ Ù„Ù„ÙƒØªØ¨</p>
                            </div>
                        </div>
                        <i class="fa-solid fa-arrow-left text-gray-300 dark:text-gray-600"></i>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
                <div onclick="loadPostsByType('note')" class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-5 cursor-pointer hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-100 to-cyan-100 dark:from-blue-900 dark:to-cyan-800 rounded-xl flex items-center justify-center">
                                <i class="fa-solid fa-note-sticky text-blue-600 dark:text-blue-300 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-gray-900 dark:text-white">ğŸ“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Ø®ÙˆØ§Ø·Ø±ÙŠ ÙˆØªØ£Ù…Ù„Ø§ØªÙŠ</p>
                            </div>
                        </div>
                        <i class="fa-solid fa-arrow-left text-gray-300 dark:text-gray-600"></i>
                    </div>
                </div>
                
                <!-- Ø§Ù„Ø£ÙÙƒØ§Ø± -->
                <div onclick="loadPostsByType('thought')" class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-5 cursor-pointer hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-yellow-100 to-amber-100 dark:from-yellow-900 dark:to-amber-800 rounded-xl flex items-center justify-center">
                                <i class="fa-solid fa-lightbulb text-yellow-600 dark:text-yellow-300 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-gray-900 dark:text-white">ğŸ’¡ Ø§Ù„Ø£ÙÙƒØ§Ø±</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400">Ø£ÙÙƒØ§Ø± Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø³ØªÙˆØ­Ø§Ø© Ù…Ù† Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</p>
                            </div>
                        </div>
                        <i class="fa-solid fa-arrow-left text-gray-300 dark:text-gray-600"></i>
                    </div>
                </div>
            </div>
        </section>

        <!-- All Books View -->
        <section id="view-all-books" class="view-section hidden">
            <!-- Back Button -->
            <button onclick="navigateTo('library')" class="mb-6 text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white flex items-center gap-2">
                <i class="fa-solid fa-arrow-right"></i>
                <span class="text-sm">Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙƒØªØ¨Ø©</span>
            </button>
            
            <div class="mb-6">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-2">ÙƒÙ„ Ø§Ù„ÙƒØªØ¨</h2>
                <p class="text-sm text-gray-500 dark:text-gray-400">Ù…Ø±ØªØ¨Ø© Ø­Ø³Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</p>
            </div>
            
            <!-- Books Grid -->
            <div id="all-books-container" class="grid grid-cols-2 gap-4">
                <!-- Books will be loaded here dynamically -->
                <div class="space-y-4 col-span-2" id="books-skeleton">
                    <div class="flex gap-4 items-center">
                        <div class="w-16 h-24 book-cover rounded-lg skeleton"></div>
                        <div class="flex-1 space-y-2">
                            <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded skeleton w-3/4"></div>
                            <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded skeleton w-1/2"></div>
                            <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded skeleton w-1/3"></div>
                        </div>
                    </div>
                    <div class="flex gap-4 items-center">
                        <div class="w-16 h-24 book-cover rounded-lg skeleton"></div>
                        <div class="flex-1 space-y-2">
                            <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded skeleton w-3/4"></div>
                            <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded skeleton w-1/2"></div>
                            <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded skeleton w-1/3"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Statuses Menu View -->
        <section id="view-statuses-menu" class="view-section hidden">
            <!-- Back Button -->
            <button onclick="navigateTo('library')" class="mb-6 text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white flex items-center gap-2">
                <i class="fa-solid fa-arrow-right"></i>
                <span class="text-sm">Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙƒØªØ¨Ø©</span>
            </button>
            
            <div class="mb-6">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Ø§Ù„Ø±ÙÙˆÙ Ø§Ù„Ø°ÙƒÙŠØ©</h2>
                <p class="text-sm text-gray-500 dark:text-gray-400">12 Ø±ÙØ§Ù‹ Ø­Ø³Ø¨ Ø¹Ù„Ø§Ù‚ØªÙƒ Ø¨Ø§Ù„ÙƒØªØ§Ø¨</p>
            </div>
            
            <!-- Statuses Grid -->
            <div id="statuses-container" class="grid grid-cols-2 gap-3">
                <!-- Statuses will be loaded here dynamically -->
            </div>
        </section>

        <!-- Books by Status View -->
        <section id="view-books-by-status" class="view-section hidden">
            <!-- Dynamic content loaded based on status -->
        </section>

        <!-- Posts by Type View -->
        <section id="view-posts-by-type" class="view-section hidden">
            <!-- Dynamic content loaded based on post type -->
        </section>

        <!-- Profile View -->
        <section id="view-profile" class="view-section hidden">
            <!-- Dynamic content loaded from profile collection -->
        </section>

        <!-- Book Details View -->
        <section id="view-book-details" class="view-section hidden">
            <!-- Dynamic content loaded based on book ID -->
        </section>

        <!-- Settings View -->
        <section id="view-settings" class="view-section hidden">
            <!-- Settings content -->
        </section>

    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 w-full bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 z-40 pb-safe">
        <div class="flex justify-around items-center h-16 max-w-lg mx-auto">
            <button onclick="navigateTo('home')" 
                    class="nav-btn flex flex-col items-center justify-center w-1/5 h-full transition-all">
                <div class="w-8 h-8 flex items-center justify-center">
                    <i class="fa-solid fa-house text-xl text-gray-400"></i>
                </div>
                <span class="text-[10px] font-medium text-gray-400 mt-0.5">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </button>
            
            <button onclick="navigateTo('library')" 
                    class="nav-btn flex flex-col items-center justify-center w-1/5 h-full transition-all">
                <div class="w-8 h-8 flex items-center justify-center">
                    <i class="fa-solid fa-book text-xl text-gray-400"></i>
                </div>
                <span class="text-[10px] font-medium text-gray-400 mt-0.5">Ø§Ù„Ù…ÙƒØªØ¨Ø©</span>
            </button>
            
            <!-- Add Post Button -->
            <button onclick="showAddPostModal()" 
                    class="flex flex-col items-center justify-center w-1/5 h-full">
                <div class="w-14 h-14 -mt-6 bg-gradient-to-r from-primary-500 to-secondary-500 rounded-full flex items-center justify-center shadow-lg hover:shadow-xl transition-shadow">
                    <i class="fa-solid fa-plus text-white text-xl"></i>
                </div>
            </button>
            
            <button onclick="navigateTo('settings')" 
                    class="nav-btn flex flex-col items-center justify-center w-1/5 h-full transition-all">
                <div class="w-8 h-8 flex items-center justify-center">
                    <i class="fa-solid fa-gear text-xl text-gray-400"></i>
                </div>
                <span class="text-[10px] font-medium text-gray-400 mt-0.5">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
            </button>
            
            <button onclick="navigateTo('profile')" 
                    class="nav-btn flex flex-col items-center justify-center w-1/5 h-full transition-all">
                <div class="w-8 h-8 flex items-center justify-center">
                    <i class="fa-solid fa-user text-xl text-gray-400"></i>
                </div>
                <span class="text-[10px] font-medium text-gray-400 mt-0.5">Ù…Ù„ÙÙŠ</span>
            </button>
        </div>
    </nav>

    <!-- Modals -->
    <!-- Add Post Modal -->
    <div id="add-post-modal" class="modal-overlay hidden">
        <div class="modal-container w-full max-w-md">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold text-gray-900 dark:text-white">Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯</h3>
                    <button onclick="closeAddPostModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                
                <!-- Post Type Selection -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†Ø´ÙˆØ±:</label>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="selectPostType('quote')" class="post-type-btn bg-purple-50 dark:bg-purple-900/20 border-2 border-purple-200 dark:border-purple-700 rounded-xl p-4 text-center hover:bg-purple-100 dark:hover:bg-purple-900/30 transition">
                            <i class="fa-solid fa-quote-right text-purple-600 dark:text-purple-400 text-xl mb-2"></i>
                            <div class="font-medium text-purple-700 dark:text-purple-300">Ø§Ù‚ØªØ¨Ø§Ø³</div>
                        </button>
                        <button onclick="selectPostType('review')" class="post-type-btn bg-green-50 dark:bg-green-900/20 border-2 border-green-200 dark:border-green-700 rounded-xl p-4 text-center hover:bg-green-100 dark:hover:bg-green-900/30 transition">
                            <i class="fa-solid fa-star text-green-600 dark:text-green-400 text-xl mb-2"></i>
                            <div class="font-medium text-green-700 dark:text-green-300">Ù…Ø±Ø§Ø¬Ø¹Ø©</div>
                        </button>
                        <button onclick="selectPostType('note')" class="post-type-btn bg-blue-50 dark:bg-blue-900/20 border-2 border-blue-200 dark:border-blue-700 rounded-xl p-4 text-center hover:bg-blue-100 dark:hover:bg-blue-900/30 transition">
                            <i class="fa-solid fa-note-sticky text-blue-600 dark:text-blue-400 text-xl mb-2"></i>
                            <div class="font-medium text-blue-700 dark:text-blue-300">Ù…Ù„Ø§Ø­Ø¸Ø©</div>
                        </button>
                        <button onclick="selectPostType('thought')" class="post-type-btn bg-yellow-50 dark:bg-yellow-900/20 border-2 border-yellow-200 dark:border-yellow-700 rounded-xl p-4 text-center hover:bg-yellow-100 dark:hover:bg-yellow-900/30 transition">
                            <i class="fa-solid fa-lightbulb text-yellow-600 dark:text-yellow-400 text-xl mb-2"></i>
                            <div class="font-medium text-yellow-700 dark:text-yellow-300">ÙÙƒØ±Ø©</div>
                        </button>
                    </div>
                </div>
                
                <!-- Post Form -->
                <div id="post-form" class="hidden">
                    <form id="post-form-content">
                        <input type="hidden" id="post-type">
                        
                        <!-- Content -->
                        <div class="mb-4">
                            <label for="post-content" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Ø§Ù„Ù…Ø­ØªÙˆÙ‰:</label>
                            <textarea id="post-content" rows="4" 
                                      class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm dark:text-white"
                                      placeholder="Ø§ÙƒØªØ¨ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ù‡Ù†Ø§..."></textarea>
                        </div>
                        
                        <!-- Rating (for reviews) -->
                        <div id="review-rating-section" class="hidden mb-4">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… (Ù…Ù† 10):</label>
                            <div class="flex items-center gap-1" id="rating-stars">
                                <!-- Stars will be generated dynamically -->
                            </div>
                            <input type="hidden" id="post-rating" value="0">
                        </div>
                        
                        <!-- Tags -->
                        <div class="mb-4">
                            <label for="post-tags" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Ø§Ù„ÙˆØ³ÙˆÙ…:</label>
                            <input type="text" id="post-tags" 
                                   class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm dark:text-white"
                                   placeholder="Ø§ÙØµÙ„ Ø¨ÙŠÙ† Ø§Ù„ÙˆØ³ÙˆÙ… Ø¨ÙØ§ØµÙ„Ø© (,)">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Ù…Ø«Ø§Ù„: Ø£Ø¯Ø¨, ÙÙ„Ø³ÙØ©, Ø¹Ù„Ù… Ø§Ù„Ù†ÙØ³</p>
                        </div>
                        
                        <!-- Book Selection -->
                        <div class="mb-6">
                            <label for="post-book" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Ø±Ø¨Ø· Ø¨ÙƒØªØ§Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                            <select id="post-book" 
                                    class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm dark:text-white">
                                <option value="">Ø§Ø®ØªØ± ÙƒØªØ§Ø¨Ø§Ù‹...</option>
                                <!-- Books will be loaded dynamically -->
                            </select>
                        </div>
                        
                        <!-- Submit Button -->
                        <div class="flex gap-3">
                            <button type="button" onclick="closeAddPostModal()" 
                                    class="flex-1 px-4 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition">
                                Ø¥Ù„ØºØ§Ø¡
                            </button>
                            <button type="submit" 
                                    class="flex-1 px-4 py-3 bg-primary-500 text-white rounded-xl hover:bg-primary-600 transition">
                                Ø¥Ø¶Ø§ÙØ©
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Book Modal -->
    <div id="add-book-modal" class="modal-overlay hidden">
        <div class="modal-container w-full max-w-lg">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold text-gray-900 dark:text-white">Ø¥Ø¶Ø§ÙØ© ÙƒØªØ§Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
                    <button onclick="closeAddBookModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                
                <form id="add-book-form">
                    <!-- Book information fields -->
                    <!-- Due to space constraints, I'll include a simplified version -->
                    <div class="space-y-4 max-h-[60vh] overflow-y-auto pr-2">
                        <!-- Basic Info -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨ *</label>
                                <input type="text" name="title" required 
                                       class="w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm dark:text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Ø§Ù„Ù…Ø¤Ù„Ù *</label>
                                <input type="text" name="author" required 
                                       class="w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm dark:text-white">
                            </div>
                        </div>
                        
                        <!-- Reading Status -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</label>
                            <select name="status" 
                                    class="w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm dark:text-white">
                                <option value="not_started">Ù„Ù… Ø£Ø¨Ø¯Ø£</option>
                                <option value="reading">Ø£Ù‚Ø±Ø£ Ø§Ù„Ø¢Ù†</option>
                                <option value="paused">Ù…ØªÙˆÙ‚Ù</option>
                                <option value="finished">Ù…Ù†Ø¬Ø²</option>
                            </select>
                        </div>
                        
                        <!-- Shelves -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Ø§Ù„Ø±ÙÙˆÙ</label>
                            <div class="grid grid-cols-2 gap-2">
                                <label class="flex items-center">
                                    <input type="checkbox" name="shelves" value="reading" class="mr-2">
                                    <span class="text-sm">Ø£Ù‚Ø±Ø£Ù‡ Ø­Ø§Ù„ÙŠØ§Ù‹</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="shelves" value="want_to_read" class="mr-2">
                                    <span class="text-sm">Ø£Ø±ØºØ¨ Ø¨Ù‚Ø±Ø§Ø¡ØªÙ‡</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="shelves" value="liked" class="mr-2">
                                    <span class="text-sm">Ø£Ø¹Ø¬Ø¨Ù†ÙŠ</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="shelves" value="recommended" class="mr-2">
                                    <span class="text-sm">Ø£Ù†ØµØ­ Ø¨Ù‡</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="shelves" value="changed_me" class="mr-2">
                                    <span class="text-sm">ØºÙŠÙ‘Ø± ØªÙÙƒÙŠØ±ÙŠ</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="shelves" value="confused" class="mr-2">
                                    <span class="text-sm">Ø­ÙŠÙ‘Ø±Ù†ÙŠ</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="shelves" value="heavy" class="mr-2">
                                    <span class="text-sm">Ø«Ù‚ÙŠÙ„ Ù„ÙƒÙ† Ù…Ù‡Ù…</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="shelves" value="emotional" class="mr-2">
                                    <span class="text-sm">Ø¹Ø§Ø·ÙÙŠ</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="shelves" value="strong_start" class="mr-2">
                                    <span class="text-sm">Ø¨Ø¯Ø£ Ù‚ÙˆÙŠÙ‹Ø§ Ø«Ù… Ø®ÙÙ‘</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="shelves" value="experiment" class="mr-2">
                                    <span class="text-sm">ØªØ¬Ø±Ø¨Ø©</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="shelves" value="reread" class="mr-2">
                                    <span class="text-sm">Ø£Ø¹Ø¯Øª Ù‚Ø±Ø§Ø¡ØªÙ‡</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="shelves" value="later" class="mr-2">
                                    <span class="text-sm">Ù„Ù„Ø±Ø¬ÙˆØ¹ Ù„Ø§Ø­Ù‚Ù‹Ø§</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Cover Image -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù</label>
                            <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center">
                                <i class="fa-solid fa-cloud-arrow-up text-gray-400 text-2xl mb-2"></i>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">Ø§Ù†Ù‚Ø± Ù„ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø©</p>
                                <input type="file" name="cover" accept="image/*" class="hidden" id="cover-upload">
                                <button type="button" onclick="document.getElementById('cover-upload').click()" 
                                        class="text-sm text-primary-500 hover:text-primary-600">Ø§Ø®ØªØ± ØµÙˆØ±Ø©</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex gap-3 mt-6">
                        <button type="button" onclick="closeAddBookModal()" 
                                class="flex-1 px-4 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button type="submit" 
                                class="flex-1 px-4 py-3 bg-primary-500 text-white rounded-xl hover:bg-primary-600 transition">
                            Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒØªØ§Ø¨
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script type="module">
        // Import Firebase functions
        import { collection, getDocs, doc, getDoc, query, where, orderBy, limit, addDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        // App State
        const appState = {
            currentView: 'home',
            previousView: 'home',
            currentBookId: null,
            currentStatus: null,
            booksData: [],
            postsData: [],
            quotesData: [],
            reviewsData: [],
            notesData: [],
            thoughtsData: [],
            profileData: null,
            searchResults: [],
            fuse: null,
            theme: localStorage.getItem('theme') || 'classic'
        };

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Load initial data
            loadHomePosts();
            loadProfile();
            setupSearch();
            applyTheme();
            
            // Set active nav
            updateActiveNav('home');
            
            // Search button toggle
            document.getElementById('search-btn').addEventListener('click', function() {
                const searchBar = document.getElementById('search-bar');
                searchBar.classList.toggle('hidden');
            });
            
            // Theme toggle
            document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
            
            // Advanced filters toggle
            document.getElementById('toggle-filters').addEventListener('click', function() {
                const filters = document.getElementById('advanced-filters');
                filters.classList.toggle('hidden');
                this.textContent = filters.classList.contains('hidden') ? '+ ÙÙ„Ø§ØªØ± Ù…ØªÙ‚Ø¯Ù…Ø©' : '- Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙÙ„Ø§ØªØ±';
            });
            
            // Apply filters
            document.getElementById('apply-filters').addEventListener('click', applyFilters);
            document.getElementById('reset-filters').addEventListener('click', resetFilters);
            
            // Search functionality
            document.getElementById('search-input')?.addEventListener('input', function(e) {
                performSearch(e.target.value);
            });
            
            // Post form submission
            document.getElementById('post-form-content')?.addEventListener('submit', handlePostSubmit);
            
            // Book form submission
            document.getElementById('add-book-form')?.addEventListener('submit', handleBookSubmit);
            
            // Load books for dropdown
            loadBooksForDropdown();
            
            // Handle back button
            window.addEventListener('popstate', handleBackButton);
            
            // Initialize rating stars
            initializeRatingStars();
        });

        // Navigation with history
        function navigateTo(viewId, params = {}) {
            // Save current view
            appState.previousView = appState.currentView;
            
            // Hide all views
            document.querySelectorAll('.view-section').forEach(el => {
                el.classList.add('hidden');
            });
            
            // Update header title
            updateHeaderTitle(viewId);
            
            // Show target view
            const targetView = document.getElementById(`view-${viewId}`);
            if (targetView) {
                targetView.classList.remove('hidden');
                appState.currentView = viewId;
                
                // Load data for specific views
                switch(viewId) {
                    case 'home':
                        loadHomePosts();
                        break;
                    case 'library':
                        // Already loaded
                        break;
                    case 'profile':
                        loadProfile();
                        break;
                    case 'all-books':
                        loadAllBooks();
                        break;
                    case 'statuses-menu':
                        loadStatusesMenu();
                        break;
                    case 'books-by-status':
                        if (params.status) loadBooksByStatus(params.status);
                        break;
                    case 'posts-by-type':
                        if (params.type) loadPostsByType(params.type);
                        break;
                    case 'settings':
                        loadSettings();
                        break;
                }
            }
            
            // Update navigation
            updateActiveNav(viewId);
            
            // Add to history
            history.pushState({ view: viewId, params: params }, '', `#${viewId}`);
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Handle back button
        function handleBackButton(event) {
            if (appState.previousView) {
                navigateTo(appState.previousView);
            }
        }

        // Go back function
        function goBack() {
            if (appState.previousView) {
                navigateTo(appState.previousView);
            } else {
                navigateTo('home');
            }
        }

        // Update header title based on view
        function updateHeaderTitle(viewId) {
            const titleMap = {
                'home': 'ğŸ“š Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„ÙÙƒØ±ÙŠ',
                'library': 'ğŸ“š Ø§Ù„Ù…ÙƒØªØ¨Ø©',
                'profile': 'ğŸ‘¤ Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ',
                'quotes': 'âœï¸ Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª',
                'reviews': 'â­ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª',
                'notes': 'ğŸ“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª',
                'thoughts': 'ğŸ’¡ Ø§Ù„Ø£ÙÙƒØ§Ø±',
                'book-details': 'ğŸ“– ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØªØ§Ø¨',
                'all-books': 'ğŸ“š ÙƒÙ„ Ø§Ù„ÙƒØªØ¨',
                'statuses-menu': 'ğŸ§  Ø§Ù„Ø±ÙÙˆÙ Ø§Ù„Ø°ÙƒÙŠØ©',
                'books-by-status': 'ğŸ“š Ø§Ù„ÙƒØªØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©',
                'posts-by-type': 'ğŸ“ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª',
                'settings': 'âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª'
            };
            
            document.getElementById('header-title').textContent = titleMap[viewId] || 'ğŸ“š Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ø§Ù„ÙÙƒØ±ÙŠ';
        }

        // Update active navigation button
        function updateActiveNav(viewId) {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                const icon = btn.querySelector('i');
                const text = btn.querySelector('span');
                
                if (icon) icon.classList.remove('text-primary-600');
                if (icon) icon.classList.add('text-gray-400');
                if (text) text.classList.remove('text-primary-600');
                if (text) text.classList.add('text-gray-400');
            });
            
            // Activate current button
            let activeBtn;
            if (viewId === 'home') {
                activeBtn = document.querySelector('button[onclick="navigateTo(\'home\')"]');
            } else if (viewId === 'library') {
                activeBtn = document.querySelector('button[onclick="navigateTo(\'library\')"]');
            } else if (viewId === 'settings') {
                activeBtn = document.querySelector('button[onclick="navigateTo(\'settings\')"]');
            } else if (viewId === 'profile') {
                activeBtn = document.querySelector('button[onclick="navigateTo(\'profile\')"]');
            }
            
            if (activeBtn) {
                const icon = activeBtn.querySelector('i');
                const text = activeBtn.querySelector('span');
                
                if (icon) {
                    icon.classList.remove('text-gray-400');
                    icon.classList.add('text-primary-600');
                }
                if (text) {
                    text.classList.remove('text-gray-400');
                    text.classList.add('text-primary-600');
                }
            }
        }

        // Show add post modal
        function showAddPostModal() {
            document.getElementById('add-post-modal').classList.remove('hidden');
        }

        // Close add post modal
        function closeAddPostModal() {
            document.getElementById('add-post-modal').classList.add('hidden');
            document.getElementById('post-form').classList.add('hidden');
            document.querySelectorAll('.post-type-btn').forEach(btn => {
                btn.classList.remove('border-primary-500', 'dark:border-primary-400');
            });
        }

        // Select post type
        function selectPostType(type) {
            document.getElementById('post-type').value = type;
            document.getElementById('post-form').classList.remove('hidden');
            
            // Reset form
            document.getElementById('post-content').value = '';
            document.getElementById('post-tags').value = '';
            document.getElementById('post-book').value = '';
            document.getElementById('post-rating').value = '0';
            
            // Update rating section visibility
            if (type === 'review') {
                document.getElementById('review-rating-section').classList.remove('hidden');
                updateRatingStars(0);
            } else {
                document.getElementById('review-rating-section').classList.add('hidden');
            }
            
            // Highlight selected button
            document.querySelectorAll('.post-type-btn').forEach(btn => {
                btn.classList.remove('border-primary-500', 'dark:border-primary-400');
            });
            event.currentTarget.classList.add('border-primary-500', 'dark:border-primary-400');
        }

        // Initialize rating stars
        function initializeRatingStars() {
            const starsContainer = document.getElementById('rating-stars');
            if (!starsContainer) return;
            
            starsContainer.innerHTML = '';
            for (let i = 1; i <= 10; i++) {
                const star = document.createElement('span');
                star.className = 'rating-star text-2xl text-gray-300 dark:text-gray-600';
                star.innerHTML = 'â˜…';
                star.dataset.value = i;
                star.onclick = () => updateRatingStars(i);
                starsContainer.appendChild(star);
            }
        }

        // Update rating stars
        function updateRatingStars(rating) {
            document.getElementById('post-rating').value = rating;
            const stars = document.querySelectorAll('.rating-star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.remove('text-gray-300', 'dark:text-gray-600');
                    star.classList.add('text-yellow-400');
                } else {
                    star.classList.remove('text-yellow-400');
                    star.classList.add('text-gray-300', 'dark:text-gray-600');
                }
            });
        }

        // Handle post submit
        async function handlePostSubmit(e) {
            e.preventDefault();
            
            const type = document.getElementById('post-type').value;
            const content = document.getElementById('post-content').value;
            const tags = document.getElementById('post-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
            const bookId = document.getElementById('post-book').value;
            const rating = type === 'review' ? parseInt(document.getElementById('post-rating').value) : null;
            
            if (!content) {
                showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰');
                return;
            }
            
            try {
                const postData = {
                    type: type,
                    content: content,
                    tags: tags,
                    rating: rating,
                    bookIds: bookId ? [bookId] : [],
                    createdAt: new Date(),
                    updatedAt: new Date()
                };
                
                await addDoc(collection(window.db, 'posts'), postData);
                
                showSuccess('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­');
                closeAddPostModal();
                
                // Reload posts if on home page
                if (appState.currentView === 'home') {
                    loadHomePosts();
                }
            } catch (error) {
                console.error('Error adding post:', error);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø´ÙˆØ±');
            }
        }

        // Show add book modal
        function showAddBookModal() {
            document.getElementById('add-book-modal').classList.remove('hidden');
        }

        // Close add book modal
        function closeAddBookModal() {
            document.getElementById('add-book-modal').classList.add('hidden');
        }

        // Handle book submit
        async function handleBookSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const bookData = {
                title: formData.get('title'),
                author: formData.get('author'),
                status: formData.get('status'),
                shelves: formData.getAll('shelves'),
                addedAt: new Date(),
                updatedAt: new Date()
            };
            
            try {
                // Handle cover image
                const coverFile = formData.get('cover');
                if (coverFile && coverFile.size > 0) {
                    const reader = new FileReader();
                    reader.onload = async function(event) {
                        bookData.coverImage = event.target.result;
                        await saveBook(bookData);
                    };
                    reader.readAsDataURL(coverFile);
                } else {
                    await saveBook(bookData);
                }
            } catch (error) {
                console.error('Error adding book:', error);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒØªØ§Ø¨');
            }
        }

        // Save book to Firestore
        async function saveBook(bookData) {
            await addDoc(collection(window.db, 'books'), bookData);
            showSuccess('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒØªØ§Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
            closeAddBookModal();
            
            // Reload books if on books page
            if (appState.currentView === 'all-books') {
                loadAllBooks();
            }
        }

        // Load books for dropdown
        async function loadBooksForDropdown() {
            try {
                const booksQuery = query(collection(window.db, 'books'), orderBy('title'));
                const querySnapshot = await getDocs(booksQuery);
                const select = document.getElementById('post-book');
                
                // Clear existing options except first
                while (select.options.length > 1) {
                    select.remove(1);
                }
                
                querySnapshot.forEach((doc) => {
                    const book = doc.data();
                    const option = document.createElement('option');
                    option.value = doc.id;
                    option.textContent = book.title;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading books for dropdown:', error);
            }
        }

        // Setup search with Fuse.js
        async function setupSearch() {
            try {
                // Load all data for search
                const [booksSnapshot, postsSnapshot] = await Promise.all([
                    getDocs(collection(window.db, 'books')),
                    getDocs(collection(window.db, 'posts'))
                ]);
                
                const searchData = [];
                
                booksSnapshot.forEach(doc => {
                    searchData.push({
                        id: doc.id,
                        type: 'book',
                        ...doc.data()
                    });
                });
                
                postsSnapshot.forEach(doc => {
                    searchData.push({
                        id: doc.id,
                        type: 'post',
                        ...doc.data()
                    });
                });
                
                // Initialize Fuse.js
                appState.fuse = new Fuse(searchData, {
                    keys: ['title', 'author', 'content', 'tags'],
                    threshold: 0.3,
                    includeScore: true
                });
            } catch (error) {
                console.error('Error setting up search:', error);
            }
        }

        // Perform search
        function performSearch(query) {
            if (!query.trim()) {
                appState.searchResults = [];
                return;
            }
            
            if (appState.fuse) {
                const results = appState.fuse.search(query);
                appState.searchResults = results.map(result => result.item);
                
                // Display search results based on current view
                displaySearchResults(appState.searchResults);
            }
        }

        // Display search results
        function displaySearchResults(results) {
            // This function would update the current view with search results
            // Implementation depends on the current view
        }

        // Apply filters
        function applyFilters() {
            const type = document.getElementById('filter-type').value;
            const rating = document.getElementById('filter-rating').value;
            
            // Filter search results based on selected filters
            let filtered = appState.searchResults;
            
            if (type !== 'all') {
                filtered = filtered.filter(item => item.type === type);
            }
            
            if (rating !== 'all') {
                filtered = filtered.filter(item => item.rating >= parseInt(rating));
            }
            
            // Display filtered results
            displaySearchResults(filtered);
        }

        // Reset filters
        function resetFilters() {
            document.getElementById('filter-type').value = 'all';
            document.getElementById('filter-rating').value = 'all';
            performSearch(document.getElementById('search-input').value);
        }

        // Load posts by type
        async function loadPostsByType(type) {
            navigateTo('posts-by-type', { type: type });
            
            try {
                const postsQuery = query(
                    collection(window.db, 'posts'),
                    where('type', '==', type),
                    orderBy('createdAt', 'desc')
                );
                
                const querySnapshot = await getDocs(postsQuery);
                const posts = [];
                
                querySnapshot.forEach((doc) => {
                    posts.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                renderPostsByType(posts, type);
            } catch (error) {
                console.error('Error loading posts:', error);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª');
            }
        }

        // Render posts by type
        function renderPostsByType(posts, type) {
            const typeNames = {
                'quote': 'Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª',
                'review': 'Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª',
                'note': 'Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª',
                'thought': 'Ø§Ù„Ø£ÙÙƒØ§Ø±'
            };
            
            const container = document.getElementById('view-posts-by-type');
            container.innerHTML = `
                <!-- Back Button -->
                <button onclick="navigateTo('library')" class="mb-6 text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white flex items-center gap-2">
                    <i class="fa-solid fa-arrow-right"></i>
                    <span class="text-sm">Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙƒØªØ¨Ø©</span>
                </button>
                
                <div class="mb-6">
                    <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-2">${typeNames[type] || type}</h2>
                    <p class="text-sm text-gray-500 dark:text-gray-400">${posts.length} ${typeNames[type] || 'Ù…Ù†Ø´ÙˆØ±'}</p>
                </div>
                
                <div class="space-y-4">
                    ${posts.length === 0 ? `
                        <div class="text-center py-8">
                            <i class="fa-regular fa-newspaper text-4xl text-gray-300 dark:text-gray-600 mb-3"></i>
                            <p class="text-gray-500 dark:text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ ${typeNames[type] || 'Ù…Ù†Ø´ÙˆØ±Ø§Øª'} Ø¨Ø¹Ø¯</p>
                        </div>
                    ` : posts.map(post => `
                        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm p-5 animate-slide-up">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex items-center gap-2">
                                    <span class="post-${post.type} text-xs font-medium px-3 py-1 rounded-full">
                                        ${getPostTypeIcon(post.type)} ${getPostTypeText(post.type)}
                                    </span>
                                    <span class="text-xs text-gray-400">${formatDate(post.createdAt)}</span>
                                </div>
                            </div>
                            
                            <p class="text-gray-800 dark:text-gray-200 leading-relaxed mb-4">${post.content}</p>
                            
                            ${post.rating ? `
                                <div class="mb-3">
                                    <div class="flex items-center gap-1">
                                        ${Array.from({length: 5}, (_, i) => `
                                            <i class="fa-${i < Math.floor(post.rating/2) ? 'solid' : 'regular'} fa-star text-amber-400"></i>
                                        `).join('')}
                                        <span class="text-sm text-gray-600 dark:text-gray-400 mr-2">${post.rating}/10</span>
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${post.tags && post.tags.length > 0 ? `
                                <div class="flex flex-wrap gap-1">
                                    ${post.tags.map(tag => `
                                        <span class="bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-xs px-2 py-1 rounded">#${tag}</span>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Load statuses menu with all 12 shelves
        function loadStatusesMenu() {
            navigateTo('statuses-menu');
            
            const statuses = [
                { id: 'reading', name: 'Ø£Ù‚Ø±Ø£Ù‡ Ø­Ø§Ù„ÙŠØ§Ù‹', icon: 'fa-book-open', color: 'from-amber-100 to-yellow-100 dark:from-amber-900 dark:to-yellow-800' },
                { id: 'want_to_read', name: 'Ø£Ø±ØºØ¨ Ø¨Ù‚Ø±Ø§Ø¡ØªÙ‡', icon: 'fa-bookmark', color: 'from-blue-100 to-cyan-100 dark:from-blue-900 dark:to-cyan-800' },
                { id: 'liked', name: 'Ø£Ø¹Ø¬Ø¨Ù†ÙŠ', icon: 'fa-thumbs-up', color: 'from-green-100 to-emerald-100 dark:from-green-900 dark:to-emerald-800' },
                { id: 'recommended', name: 'Ø£Ù†ØµØ­ Ø¨Ù‡', icon: 'fa-star', color: 'from-yellow-100 to-amber-100 dark:from-yellow-900 dark:to-amber-800' },
                { id: 'changed_me', name: 'ØºÙŠÙ‘Ø± ØªÙÙƒÙŠØ±ÙŠ', icon: 'fa-brain', color: 'from-pink-100 to-rose-100 dark:from-pink-900 dark:to-rose-800' },
                { id: 'confused', name: 'Ø­ÙŠÙ‘Ø±Ù†ÙŠ', icon: 'fa-question', color: 'from-purple-100 to-violet-100 dark:from-purple-900 dark:to-violet-800' },
                { id: 'heavy', name: 'Ø«Ù‚ÙŠÙ„ Ù„ÙƒÙ† Ù…Ù‡Ù…', icon: 'fa-weight-hanging', color: 'from-red-100 to-rose-100 dark:from-red-900 dark:to-rose-800' },
                { id: 'emotional', name: 'Ø¹Ø§Ø·ÙÙŠ', icon: 'fa-heart', color: 'from-orange-100 to-red-100 dark:from-orange-900 dark:to-red-800' },
                { id: 'strong_start', name: 'Ø¨Ø¯Ø£ Ù‚ÙˆÙŠÙ‹Ø§ Ø«Ù… Ø®ÙÙ‘', icon: 'fa-chart-line', color: 'from-teal-100 to-emerald-100 dark:from-teal-900 dark:to-emerald-800' },
                { id: 'experiment', name: 'ØªØ¬Ø±Ø¨Ø©', icon: 'fa-flask', color: 'from-indigo-100 to-blue-100 dark:from-indigo-900 dark:to-blue-800' },
                { id: 'reread', name: 'Ø£Ø¹Ø¯Øª Ù‚Ø±Ø§Ø¡ØªÙ‡', icon: 'fa-rotate', color: 'from-cyan-100 to-blue-100 dark:from-cyan-900 dark:to-blue-800' },
                { id: 'later', name: 'Ù„Ù„Ø±Ø¬ÙˆØ¹ Ù„Ø§Ø­Ù‚Ù‹Ø§', icon: 'fa-clock', color: 'from-gray-100 to-slate-100 dark:from-gray-900 dark:to-slate-800' }
            ];
            
            const container = document.getElementById('statuses-container');
            container.innerHTML = statuses.map(status => `
                <div onclick="loadBooksByStatus('${status.id}')" 
                     class="bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm cursor-pointer hover:shadow-md transition-shadow">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br ${status.color} rounded-lg flex items-center justify-center">
                            <i class="fa-solid ${status.icon} text-gray-700 dark:text-gray-300"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-gray-900 dark:text-white text-sm">${status.name}</h4>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Load books by status (shelf)
        async function loadBooksByStatus(statusId) {
            navigateTo('books-by-status', { status: statusId });
            
            try {
                const booksQuery = query(
                    collection(window.db, 'books'),
                    where('shelves', 'array-contains', statusId)
                );
                
                const querySnapshot = await getDocs(booksQuery);
                const books = [];
                
                querySnapshot.forEach((doc) => {
                    books.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                renderBooksByStatus(books, statusId);
            } catch (error) {
                console.error('Error loading books by status:', error);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØªØ¨');
            }
        }

        // Load settings
        function loadSettings() {
            const container = document.getElementById('view-settings');
            container.innerHTML = `
                <!-- Back Button -->
                <button onclick="goBack()" class="mb-6 text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white flex items-center gap-2">
                    <i class="fa-solid fa-arrow-right"></i>
                    <span class="text-sm">Ø±Ø¬ÙˆØ¹</span>
                </button>
                
                <div class="mb-6">
                    <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
                    <p class="text-sm text-gray-500 dark:text-gray-400">ØªØ®ØµÙŠØµ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</p>
                </div>
                
                <!-- Themes -->
                <div class="mb-8">
                    <h3 class="font-bold text-gray-900 dark:text-white mb-4">ğŸ¨ Ø§Ù„Ø«ÙŠÙ…Ø§Øª</h3>
                    <div class="grid grid-cols-3 gap-3">
                        <button onclick="changeTheme('classic')" class="theme-btn bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4 rounded-xl text-center">
                            ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ
                        </button>
                        <button onclick="changeTheme('light')" class="theme-btn bg-gradient-to-r from-blue-400 to-emerald-400 text-white p-4 rounded-xl text-center">
                            ÙØ§ØªØ­
                        </button>
                        <button onclick="changeTheme('dark')" class="theme-btn bg-gradient-to-r from-gray-800 to-gray-900 text-white p-4 rounded-xl text-center">
                            Ø¯Ø§ÙƒÙ†
                        </button>
                        <button onclick="changeTheme('ocean')" class="theme-btn bg-gradient-to-r from-cyan-500 to-blue-500 text-white p-4 rounded-xl text-center">
                            Ù…Ø­ÙŠØ·
                        </button>
                        <button onclick="changeTheme('neon')" class="theme-btn bg-gradient-to-r from-cyan-400 to-purple-500 text-white p-4 rounded-xl text-center">
                            Ù†ÙŠÙˆÙ†
                        </button>
                        <button onclick="changeTheme('earth')" class="theme-btn bg-gradient-to-r from-amber-500 to-emerald-500 text-white p-4 rounded-xl text-center">
                            ØªØ±Ø§Ø¨ÙŠ
                        </button>
                    </div>
                </div>
                
                <!-- Backup Section -->
                <div class="mb-8">
                    <h3 class="font-bold text-gray-900 dark:text-white mb-4">ğŸ’¾ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h3>
                    <div class="space-y-3">
                        <button onclick="exportData()" class="w-full bg-green-500 hover:bg-green-600 text-white p-3 rounded-xl text-center transition">
                            <i class="fa-solid fa-download mr-2"></i>ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                        <button onclick="importData()" class="w-full bg-blue-500 hover:bg-blue-600 text-white p-3 rounded-xl text-center transition">
                            <i class="fa-solid fa-upload mr-2"></i>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                    </div>
                </div>
                
                <!-- Add Book Button -->
                <div class="mb-8">
                    <h3 class="font-bold text-gray-900 dark:text-white mb-4">ğŸ“š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØªØ¨</h3>
                    <button onclick="showAddBookModal()" class="w-full bg-primary-500 hover:bg-primary-600 text-white p-3 rounded-xl text-center transition">
                        <i class="fa-solid fa-plus mr-2"></i>Ø¥Ø¶Ø§ÙØ© ÙƒØªØ§Ø¨ Ø¬Ø¯ÙŠØ¯
                    </button>
                </div>
            `;
        }

        // Toggle theme
        function toggleTheme() {
            const isDark = document.documentElement.classList.contains('dark');
            if (isDark) {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                document.getElementById('theme-icon').className = 'fa-solid fa-sun';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                document.getElementById('theme-icon').className = 'fa-solid fa-moon';
            }
        }

        // Apply theme
        function applyTheme() {
            const theme = localStorage.getItem('theme') || 'classic';
            changeTheme(theme);
            
            if (theme === 'dark' || localStorage.getItem('darkMode') === 'true') {
                document.documentElement.classList.add('dark');
                document.getElementById('theme-icon').className = 'fa-solid fa-moon';
            } else {
                document.documentElement.classList.remove('dark');
                document.getElementById('theme-icon').className = 'fa-solid fa-sun';
            }
        }

        // Change theme
        function changeTheme(themeName) {
            // Remove all theme classes
            document.body.classList.remove('theme-classic', 'theme-light', 'theme-dark', 'theme-ocean', 'theme-neon', 'theme-earth');
            
            // Add new theme class
            document.body.classList.add(`theme-${themeName}`);
            
            // Update theme in localStorage
            localStorage.setItem('theme', themeName);
            appState.theme = themeName;
            
            // Show success message
            showSuccess(`ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø«ÙŠÙ… Ø¥Ù„Ù‰ ${themeName}`);
        }

        // Export data
        function exportData() {
            // Implement data export
            showSuccess('Ø³ÙŠØªÙ… ØªÙ†Ø²ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù‚Ø±ÙŠØ¨Ø§Ù‹');
        }

        // Import data
        function importData() {
            // Implement data import
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json,.zip';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                // Process file import
                showSuccess('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
            };
            input.click();
        }

        // Utility Functions
        function getPostTypeIcon(type) {
            const icons = {
                'note': 'ğŸ“',
                'quote': 'âœï¸',
                'review': 'â­',
                'thought': 'ğŸ’¡'
            };
            return icons[type] || 'ğŸ“„';
        }

        function getPostTypeText(type) {
            const texts = {
                'note': 'Ù…Ù„Ø§Ø­Ø¸Ø©',
                'quote': 'Ø§Ù‚ØªØ¨Ø§Ø³',
                'review': 'Ù…Ø±Ø§Ø¬Ø¹Ø©',
                'thought': 'ÙÙƒØ±Ø©'
            };
            return texts[type] || 'Ù…Ù†Ø´ÙˆØ±';
        }

        function getStatusText(status) {
            const texts = {
                'reading': 'Ø£Ù‚Ø±Ø£Ù‡ Ø­Ø§Ù„ÙŠØ§Ù‹',
                'want_to_read': 'Ø£Ø±ØºØ¨ Ø¨Ù‚Ø±Ø§Ø¡ØªÙ‡',
                'liked': 'Ø£Ø¹Ø¬Ø¨Ù†ÙŠ',
                'recommended': 'Ø£Ù†ØµØ­ Ø¨Ù‡',
                'changed_me': 'ØºÙŠÙ‘Ø± ØªÙÙƒÙŠØ±ÙŠ',
                'confused': 'Ø­ÙŠÙ‘Ø±Ù†ÙŠ',
                'heavy': 'Ø«Ù‚ÙŠÙ„ Ù„ÙƒÙ† Ù…Ù‡Ù…',
                'emotional': 'Ø¹Ø§Ø·ÙÙŠ',
                'strong_start': 'Ø¨Ø¯Ø£ Ù‚ÙˆÙŠÙ‹Ø§ Ø«Ù… Ø®ÙÙ‘',
                'experiment': 'ØªØ¬Ø±Ø¨Ø©',
                'reread': 'Ø£Ø¹Ø¯Øª Ù‚Ø±Ø§Ø¡ØªÙ‡',
                'later': 'Ù„Ù„Ø±Ø¬ÙˆØ¹ Ù„Ø§Ø­Ù‚Ù‹Ø§'
            };
            return texts[status] || status;
        }

        function formatDate(date) {
            if (!date) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            if (date.toDate) {
                date = date.toDate();
            }
            
            return date.toLocaleDateString('ar-SA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function showSuccess(message) {
            // Create toast notification
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 left-4 right-4 bg-green-500 text-white p-3 rounded-xl shadow-lg z-50 animate-slide-down';
            toast.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fa-solid fa-check-circle mr-2"></i>
                        <span>${message}</span>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-white hover:text-gray-100">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
            `;
            document.body.appendChild(toast);
            
            // Remove toast after 3 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 3000);
        }

        function showError(message) {
            // Create error toast
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 left-4 right-4 bg-red-500 text-white p-3 rounded-xl shadow-lg z-50 animate-slide-down';
            toast.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fa-solid fa-exclamation-circle mr-2"></i>
                        <span>${message}</span>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-white hover:text-gray-100">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
            `;
            document.body.appendChild(toast);
            
            // Remove toast after 3 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 3000);
        }

        // Keep existing functions from your original code (loadHomePosts, loadAllBooks, etc.)
        // Add them here with necessary modifications for the new features

        // Make functions globally available
        window.navigateTo = navigateTo;
        window.goBack = goBack;
        window.loadAllBooks = loadAllBooks;
        window.loadStatusesMenu = loadStatusesMenu;
        window.loadBooksByStatus = loadBooksByStatus;
        window.loadPostsByType = loadPostsByType;
        window.showAddPostModal = showAddPostModal;
        window.closeAddPostModal = closeAddPostModal;
        window.selectPostType = selectPostType;
        window.showAddBookModal = showAddBookModal;
        window.closeAddBookModal = closeAddBookModal;
        window.changeTheme = changeTheme;
        window.exportData = exportData;
        window.importData = importData;
        window.updateRatingStars = updateRatingStars;

        // Initialize the rest of your existing functions here...
        // (The functions from your original code that handle loading books, posts, etc.)

    </script>
</body>
</html>
